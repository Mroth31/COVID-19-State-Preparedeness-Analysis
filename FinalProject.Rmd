---
title: "FinalProject"
author: "Ajay Karatam and Michael Rothschilds"
date: "5/13/2020"
output: html_document
---
## An Analysis of U.S Hospital Bed Capacity During the COVID-19 Pandemic
by Michael Rothschilds and Ajay Karatam

## Introduction: 
The COVID-19 pandemic has altered the lives of millions over the past few months. 
People have practiced Social Distancing at an unprecedented level with the intention 
of keeping people safe and "flattening the curve". The purpose of "flattening the curve" 
is to prevent hospitals from being overun with too many COVID-19 patients at once. 
In order to stop this from happening, public health and government officials need to 
project the number of cases, the rate of hospitilization, and the resulting number of 
hospital and ICU beds needed at any given time across all areas of the United States. 
The following data was collected from a team of researchers at the Harvard Global Data Institute. 
They made projections for different infection rates and used surveys conducted by 
The American Hospital Association to predict the true availability of hospital and ICU beds.

## Examine the original dataset here: 
https://www.kaggle.com/mrmorj/hospital-bed-capacity-and-covid19

## R Libraries Used
``` {r libraries}
library(tidyverse)
library(lubridate)
```



## Dataframe Setup and Tidying

```{r setup}
csv_file <- "HRR_Scorecard.csv"
hcb <- read_csv(csv_file)

#delete the first entry since it contains garbage values
hcb = hcb[-1,]
df <- hcb %>%
  #choose the relevant columns that we want to work with from hcb 
  select(1:12)
df
#extract the state as a separate column from HRR
df$State <- str_extract(df$HRR, "([A-Z]{2})")

#extract the town as a separate column from HRR
df$Town <- str_extract (df$HRR, "[A-Za-z]+")

#re-arrange the columns to make the data more presentable
df <- df[c(14,13,2,4,5,3,6,7,8,9,10,11,12)]

#calculate the percentage of occupied hospital beds
df$calc_hospital = ((df[c(4)] / df[c(3)])*100)
df$`Occupied Hospital Beds percentage` <- round(df$calc_hospital$`Available Hospital Beds`,digits=2) 

#calculate the percent of occupied ICU beds
df$calc_ICU = ((df[c(7)] / df[c(6)])*100)
df$`Occupied ICU Beds percentage` <- round(df$calc_ICU$`Available ICU Beds`, digits=2)

#final columns re-arrangement
df <- df[c(1,2,3,4,5,15,6,7,8,17,9,10,11,12,13)]
```
## Population Data Frame:
Create a data frame focusing on the estimated COVID-19 General Population Data. 
Take the Region data and turn it into statewide data. 
Once we have statewide data, we multiply the Projected infections, hospitalizations, 
and ICU admittances by 3 to represent a doomsday scenario where 60 percent of adults 
get the virus rather than 20 percent in the original data frame. 
This represents a 200 percent increase in projected cases but is a plausible scenario.
Create a Scatter Plot showing which states have the highest percentage of elderly adults as 
part of their adult population.

``` {r popdataframe}
pop_df <- df %>% select(Town, State, `Adult Population`, `Population 65+`, `Projected Infected Individuals`, `Projected Hospitalized Individuals`, `Projected Individuals Needing ICU Care`)

states_pop_df <- pop_df %>% 
  group_by(State) %>%
  summarize(Adult_Population = sum(`Adult Population`), `Population 65+` = sum(`Population 65+`), Projected_Infected_Individuals = sum(`Projected Infected Individuals`), Projected_Hospitalized_Individuals = sum(`Projected Hospitalized Individuals`), Projected_ICU_Care = sum(`Projected Individuals Needing ICU Care`))

states_pop_df <- states_pop_df %>%
  mutate(DoomsDay_Projected_Infected_Individuals = Projected_Infected_Individuals * 3, Doomsday_Projected_Hospitalized_Individuals = Projected_Hospitalized_Individuals *3, Doomsday_Projected_ICU_Care = Projected_ICU_Care * 3)


states_pop_df %>%
  mutate(Percentage_Adults_Older_65 = (`Population 65+` / Adult_Population) * 100) %>%
  ggplot(mapping=aes(x=Percentage_Adults_Older_65, y= Adult_Population, color = State))+
  geom_point()+
  labs(title = "Percentage of Adults Older than 65 In Each State", x="Percentage", y="Number of Adults")
  
```




